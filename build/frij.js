const e=e=>{let t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t},t=(e,t)=>("string"==typeof t&&(t=((e,t)=>(t=t||document).querySelector(e))(t)),t.appendChild(e)),a=e=>e.content.cloneNode(!0),r=({name:r,html:o,onPropsChange:n,preLoad:s,onLoaded:i,onUnloaded:l,observedProps:d,onStateChanges:c,onCreate:h},p)=>{class u extends HTMLElement{constructor(){super(),this._state={},s&&s(this),this._shadowRoot=this.attachShadow({mode:"open"});let r=e(o);t(a(r),this._shadowRoot),this._state.shadow=this._shadowRoot,h&&h(this,this._shadowRoot)}static get observedAttributes(){return d||[]}attributeChangedCallback(e,t,a){n&&n(this,this._shadowRoot,{name:e,oldVal:t,newVal:a})}connectedCallback(){i&&i(this,this._shadowRoot)}disconnectedCallback(){l&&l(this,this._shadowRoot)}set state(e){let t=Object.keys(e)[0];this._state[t]=e[t],c&&"function"==typeof c&&c(t,this,this._shadowRoot)}_setState(e,t){this._state[e]=t}get state(){return this._state}get setState(){return this._setState}}return window.customElements.define(`${p?p+"-":""}${r}`,u),!0};var o=(()=>{let e={},t=[];return{getStore:()=>e,getChildItem:(t,a,r="id")=>{if(!e[t])return null;let o=e[t].filter(e=>e[r]===a)[0];return o=o?JSON.parse(JSON.stringify(o)):null,o},updateItem:(a,r)=>{e[a]=r,t.forEach(e=>{e.type===a&&e.callback(JSON.parse(JSON.stringify(r)),"all",a)})},updateChildItem:(a,r,o,n="id")=>{if(!(o=o||r[n]))return void console.warn("Data could not be saved. There was no id.");e[a]||(e[a]=[]);let s={...e[a].filter(e=>e[n]===o)[0],...r};e[a]=[...e[a].filter(e=>e[n]!==o),s],t.forEach(t=>{t.type===a&&("single"===t.returnValue?t.callback(JSON.parse(JSON.stringify(s)),"updated",a):t.callback(JSON.parse(JSON.stringify(e[a])),"all",a))})},removeChildItem:(a,r,o="id")=>e[a]?(e[a]=[...e[a].filter(e=>e[o]!==r)],t.forEach(t=>{t.type===a&&("single"===t.returnValue?t.callback(JSON.parse(JSON.stringify(result)),"updated",a):t.callback(JSON.parse(JSON.stringify(e[a])),"all",a))}),e[a]):[],getItem:t=>e[t]?JSON.parse(JSON.stringify(e[t])):[],addListener:e=>{t.push(e)},removeListener:e=>{t=t.filter(t=>t.id!==e)},addToItem:(a,r)=>{if(e[a]){if(e[a]&&!Array.isArray(e[a]))return void console.warn("The item could not be saved. The Stored item is not an array.")}else e[a]=[];e[a].push(r),t.forEach(t=>{t.type===a&&("single"===t.returnValue?t.callback(JSON.parse(JSON.stringify(r)),"new",a):t.callback(JSON.parse(JSON.stringify(e[a])),"all",a))})},addManyItems:(t,a)=>{if(e[t]){if(e[t]&&!Array.isArray(e[t]))return void console.warn("The item could not be saved. The Stored item is not an array.")}else e[t]=[];a.forEach(a=>{for(i=e[t].length-1;i>=0;--i)e[t][i].id===a.id&&e[t].splice(i,1);e[t].push(a)})}}})();var n=(()=>{let e=[],t=[];const a=a=>{let r=t.find(({id:e})=>e===a),n="page";r||(r=e.find(({id:e})=>e===a),n="global"),"store"===r.selector?o.removeListener(a):r.element.removeEventListener(r.event,r.callback),"page"===n?t=t.filter(({id:e})=>e!==a):e=e.filter(({id:e})=>e!==a)},r=(a,r,n="page")=>{if(r.id||(r.id=`${(new Date).getTime()}${Math.random()}`),"store"===a)o.addListener({id:r.id,type:r.type,callback:r.callback}),r.selector="store";else{let e=a;"string"==typeof a&&(e=document.querySelector(a)),e.addEventListener(r.event,r.callback),r.selector=a,r.element=e}return"global"===n?e.push(r):t.push(r),r};return{addListener:r,addGlobalListener:(e,t)=>r(e,t,"global"),removeListener:a,removeAllPageListeners:()=>(t.forEach(({id:e})=>a(e)),!0),getListeners:(a="all")=>"page"===a?t:"global"===a?e:{page:t,global:e},getListener:a=>{let r=t.find(({id:e})=>e===a),o="page";return r||(r=e.find(({id:e})=>e===a),o="global"),{listener:r,type:o}}}})();var s=(()=>{let r=()=>{};const o=()=>{r.onUnload&&"function"==typeof r.onUnload&&r.onUnload()};return{loadPage:(s,i)=>{n.removeAllPageListeners(),o(),i.innerHTML="",r=s(),r.preLoad&&r.preLoad();let l=i.shadowRoot;l||(l=i.attachShadow({mode:"open"})),l.innerHTML="";let d=e(r.render());t(a(d),l),r.onLoad&&"function"==typeof r.onLoad&&r.onLoad(l)},unLoadPage:o}})();const l=n,d=s,c=o,h=(e,t,a)=>{if(!t)throw new Error("A Location for the loading components is required.");return new Promise((o,n)=>{let s=[];e.forEach(async n=>{let i=await import(`${t}/${n}.js`);var l;r(i.default(),a),l=n,s.push(l),s.length===e.length&&o(s)})})},p=r;export{p as createComponent,l as listeners,h as loadComponents,d as pageManager,c as store};
